<!-- HTML -->

<div class="container">
  <div class="h-full card flex align-items-center justify-content-center">
    <div class="w-8 flex flex-wrap px-5 py-5 gap-2 surface-ground border-round justify-content-center">
      @if(selectedPaciente) {
      <div class="w-full">
        <p-toolbar>
          <div class="w-7">
            <p-inputGroup>
              <input
                [(ngModel)]="query"
                type="text"
                pInputText
                [placeholder]="'Buscando por ' + filterBy"
              />
              <button
                disabled
                type="button"
                pButton
                icon="pi pi-search"
              ></button>
            </p-inputGroup>
          </div>
          <div class="w-2">
            <p-button
              (onClick)="changeFilter('nombre')"
              label="Nombre"
              [text]="true"
              [raised]="true"
              severity="info"
            />
          </div>
          <div class="w-2">
            <p-button
              (onClick)="changeFilter('especialidad')"
              label="Especialidad"
              [text]="true"
              [raised]="true"
              severity="warning"
            />
          </div>
        </p-toolbar>
      </div>
      <div
        style="overflow: auto; height: 200px"
        class="w-full flex flex-wrap px-5 py-5 gap-2 surface-ground border-round justify-content-center"
      >
        @for (especialista of getFilteredEspecialistas(); track $index){ @if
        (especialista.estaHabilitado) {
        <div
          (click)="select(especialista)"
          [class.selected]="especialista == selectedEspecialista"
          class="w-full lg:w-5 h-auto especialista-card cursor-pointer"
        >
          <div class="flex flex-row justify-content-center">
            <div class="w-4 align-items-center justify-content-center">
              <img
                [src]="especialista.imagenPerfil"
                alt="imagen perfil especialista"
              />
            </div>
            <div class="w-6">
              <p>Nombre:</p>
              <p>{{ especialista.nombre }} {{ especialista.apellido }}</p>
              <hr />
              <p>Especialidades:</p>
              <p>
                {{ especialista.especialidades }}
              </p>
              <hr />
              <p>Edad:</p>
              <p>
                {{ especialista.edad }}
              </p>
              <hr />
            </div>
          </div>
        </div>
        } }
      </div>
      @if (selectedEspecialista) {
      <div class="flex flex-column px-5 py-5">
        <p>
          Seleccionado:
          {{ selectedEspecialista.nombre }}
          {{ selectedEspecialista.apellido }}
        </p>

        <p-dropdown
          (onChange)="changeEspecialidad($event)"
          [options]="getOptions()"
          placeholder="Selecciona una especialidad"
        />

        @if(selectedEspecialidad) {
        <div style="height: 200px; overflow: auto">
          @if(fechasEspecialista) { @for (day of workingDays; track $index) {
          @if (fechasEspecialista[day].fechas.length > 0 &&
          fechasEspecialista[day].horarios.length > 0) {

          <div class="py-3">
            <p class="w-2rem">{{ day.toUpperCase() }}</p>
            @for (fecha of fechasEspecialista[day].fechas; track $index) {
            <p>{{ getFormattedDate(fecha) }}</p>
            <div
              class="flex flex-wrap gap-3 justify-content-center align-content-center"
            >
              @for (horario of fechasEspecialista[day].horarios; track $index) {
              <p-button
                (onClick)="solicitarTurno(fecha, horario)"
                [disabled]="getRemainingTurn(horario, fecha) <= 0"
                [label]="getHorario(horario, fecha)"
                icon="pi pi-clock"
              />
              }
            </div>
            }
            <hr />
          </div>
          } } }
        </div>
        }
      </div>
      } } @else {
      <div>
        <h2 class="py-3">Seleccionar paciente</h2>
        <p-table
          [tableStyle]="{ overflow: 'auto' }"
          [styleClass]="'small'"
          [value]="users"
          [tableStyle]="{ 'min-width': '50rem' }"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>Foto</th>
              <th>Nombre</th>
              <th>DNI</th>
              <th>Edad</th>
              <th>Email</th>
              <th>Obra Social</th>
              <th>Foto 2</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-user>
            <tr (click)="selectPaciente(user)" style="cursor: pointer">
              <td>
                <img
                  [src]="user.imagenPerfil"
                  alt="foto-perfil"
                  style="aspect-ratio: 4/4; width: 40px"
                />
              </td>
              <td>{{ user.nombre }}</td>
              <td>{{ user.dni }}</td>
              <td>{{ user.edad }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.obraSocial }}</td>
              <td>
                <img
                  [src]="user.imagenPerfilAux"
                  alt="foto-perfil-aux"
                  style="aspect-ratio: 4/4; width: 40px"
                />
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
      }
    </div>
  </div>
</div>
